<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">

  <changeSet id="1" author="jtodt">

    <createTable tableName="rizeni">
      <column name="rizeni_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="typ" type="varchar(32)">
        <constraints nullable="false" />
      </column>
      <column name="stav" type="varchar(32)">
        <constraints nullable="false" />
      </column>
      <column name="cesta" type="varchar(128)">
        <constraints nullable="false" />
      </column>
      <column name="cas_zalozeni" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="archiv_kod" type="varchar(50)">
        <constraints nullable="false" />
      </column>
      <column name="archiv_nazev" type="varchar(255)">
        <constraints nullable="false" />
      </column>
      <column name="cislo_jednaci_archivu" type="varchar(50)"/>
      <column name="cislo_jednaci_puvodce" type="varchar(50)"/>
      <column name="puvodce_id" type="varchar(50)">
        <constraints nullable="false" />
      </column>
      <column name="puvodce_nazev" type="varchar(255)">
        <constraints nullable="false" />
      </column>
      <column name="archivar_id" type="varchar(32)" />
      <column name="archivar_jmeno" type="varchar(128)" />
      <column name="smazat" type="boolean" />
      <column name="skartacni_lhuta" type="date"/>
    </createTable>
    
    <createTable tableName="opravneni">
      <column name="opravneni_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" foreignKeyName="fk_opravneni_rizeni"
          references="rizeni(rizeni_id)" />
      </column>
      <column name="uzivatel" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="nahrani_komponent" type="boolean">
        <constraints nullable="false"/>
      </column>
      <column name="uprava_metadat" type="boolean">
        <constraints nullable="false"/>
      </column>
      <column name="nahravani_sipu" type="boolean">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <createIndex indexName="idx_opravneni_uzivatel" tableName="opravneni" unique="false">
      <column name="uzivatel" />
    </createIndex>    

    <createTable tableName="rizeni_vlastnosti">
      <column name="rizeni_vlastnosti_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" foreignKeyName="fk_rizeni_vlastnosti_rizeni"
          references="rizeni(rizeni_id)" />
      </column>
      <column name="sloupce" type="text" />
      <column name="user_id" type="varchar(64)" />
    </createTable>

    <createTable tableName="spisovy_plan">
      <column name="spisovy_plan_id" type="int" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" foreignKeyName="fk_spisovy_plan_rizeni"
          references="rizeni(rizeni_id)" />
      </column>      
      <column name="kod" type="varchar(50)">
        <constraints nullable="false" />
      </column>
      <column name="nazev" type="varchar(255)">
        <constraints nullable="false" />
      </column>
    </createTable>
            
    <createTable tableName="informacni_balicek">
      <column name="informacni_balicek_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" references="rizeni(rizeni_id)" foreignKeyName="fk_informacni_balicek_rizeni"/>
      </column>
      <column name="spisovy_plan_id" type="int">
        <constraints references="spisovy_plan(spisovy_plan_id)" foreignKeyName="fk_informacni_balicek_spisovy_plan"/>
      </column>
      <column name="uuid" type="varchar(50)">
        <constraints nullable="false" />
      </column>
      <column name="stav_komponent" type="varchar(50)">
        <constraints nullable="false" />
      </column>
      <column name="stav_vyberu" type="varchar(50)">
        <constraints nullable="false" />
      </column>
      <column name="cesta" type="varchar(255)">
        <constraints nullable="false" />
      </column>
      <column name="velikost" type="bigint">
        <constraints nullable="false" />
      </column>      
      <column name="nazev" type="varchar(256)" />
      <column name="stav" type="varchar(50)">
        <constraints nullable="false" />
      </column>  
    </createTable>
            
    <createTable tableName="jednorazovy_ucet">
      <column name="jednorazovy_ucet_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" references="rizeni(rizeni_id)" foreignKeyName="fk_jednorazovy_ucet_rizeni"/>
      </column>
      <column name="uzivatel_id" type="varchar(50)">
        <constraints nullable="false"/>
      </column>
      <column name="jmeno" type="varchar(255)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    
    <createTable tableName="protokol">
      <column name="protokol_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" references="rizeni(rizeni_id)" foreignKeyName="fk_protokol_rizeni"/>
      </column>
      <column name="cas_vytvoreni" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="typ_protokolu" type="varchar(50)">
        <constraints nullable="false"/>
      </column>
      <column name="format_protokolu" type="varchar(50)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    
    <createTable tableName="popis_urovne">
      <column name="popis_urovne_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" references="rizeni(rizeni_id)" foreignKeyName="fk_popis_urovne_rizeni"/>
      </column>      
      <column name="popis" type="text">
        <constraints nullable="false" />
      </column>
      <column name="nasledujici_verze_id" type="bigint">
        <constraints nullable="true" />
      </column>
    </createTable>
    
    <createTable tableName="zobrazeni_urovne">
      <column name="zobrazeni_urovne_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false"
          references="rizeni(rizeni_id)"
          foreignKeyName="fk_zobrazeni_urovne_prejimka" />
      </column>
      <column name="rodic_id" type="bigint">
        <constraints 
          references="zobrazeni_urovne(zobrazeni_urovne_id)"
          foreignKeyName="fk_zobrazeni_urovne_rodic"/>
      </column>
      <column name="informacni_balicek_id" type="bigint">
        <constraints nullable="true"
          references="informacni_balicek(informacni_balicek_id)"
          foreignKeyName="fk_zobrazeni_urovne_informacni_balicek" />
      </column>
      <column name="popis_urovne_id" type="bigint">
        <constraints nullable="false"
          references="popis_urovne(popis_urovne_id)"
          foreignKeyName="fk_zobrazeni_urovne_popis_urovne" />
      </column>      
      <column name="hloubka" type="int">
        <constraints nullable="false" />
      </column>
      <column name="list" type="boolean">
        <constraints nullable="false" />
      </column>
      <column name="nazev_urovne" type="varchar(512)">
        <constraints nullable="false"/>
      </column>
      <column name="slouceni" type="text">
        <constraints nullable="true" />
      </column>
      <column name="poradi" type="int">
        <constraints nullable="false" />
      </column>      
      <column name="typ" type="varchar(16)">
        <constraints nullable="false" />
      </column>
      <column name="zamek" type="boolean">
        <constraints nullable="false" />
      </column>
      <column name="skartacni_znak" type="char(5)">
        <constraints nullable="true" />
      </column>
      <column name="rozhodnuti" type="char(1)">
        <constraints nullable="true" />
      </column>
    </createTable>

    <createTable tableName="uroven_popisu">
      <column name="uroven_popisu_id" type="bigint"
        autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false"
          references="rizeni(rizeni_id)"
          foreignKeyName="fk_uroven_popisu_rizeni" />
      </column>
      <column name="zobrazeni_urovne_id" type="bigint">
        <constraints nullable="true"
          references="zobrazeni_urovne(zobrazeni_urovne_id)"
          foreignKeyName="fk_uroven_popisu_zobrazeni_urovne" />
      </column>
      <column name="rodic_id" type="bigint">
        <constraints
          references="uroven_popisu(uroven_popisu_id)"
          foreignKeyName="fk_uroven_popisu_rodic" />
      </column>
      <column name="informacni_balicek_id" type="bigint">
        <constraints nullable="false"
          references="informacni_balicek(informacni_balicek_id)"
          foreignKeyName="fk_uroven_popisu_informacni_balicek" />
      </column>
      <column name="popis_urovne_id" type="bigint">
        <constraints nullable="false"
          references="popis_urovne(popis_urovne_id)"
          foreignKeyName="fk_uroven_popisu_popis_urovne" />
      </column>            
      <column name="absolutni_poradi" type="int">
        <constraints nullable="false" />
      </column>
      <column name="hloubka" type="int">
        <constraints nullable="false" />
      </column>
      <column name="list" type="boolean">
        <constraints nullable="false" />
      </column>
      <column name="typ" type="varchar(16)">
        <constraints nullable="false" />
      </column>
      <column name="identifikator_puvodce" type="text"/>
    </createTable>
    
    <createTable tableName="digitalni_objekt">
      <column name="digitalni_objekt_id" type="bigint"
        autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="informacni_balicek_id" type="bigint">
        <constraints nullable="true"
          foreignKeyName="fk_digitalni_objekt_informacni_balicek"
          references="informacni_balicek(informacni_balicek_id)" />
      </column>
      <column name="uroven_popisu_id" type="bigint">
        <constraints nullable="true"
          references="uroven_popisu(uroven_popisu_id)"
          foreignKeyName="fk_digitalni_objekt_uroven_popisu" />
      </column>
      <column name="zobrazeni_urovne_id" type="bigint">
        <constraints nullable="false"
          references="zobrazeni_urovne(zobrazeni_urovne_id)"
          foreignKeyName="fk_digitalni_objekt_zobrazeni_urovne" />
      </column>
      <column name="soubor" type="varchar(256)">
        <constraints nullable="false" />
      </column>
      <column name="mime" type="varchar(255)">
          <constraints nullable="false" />
      </column>
      <column name="velikost" type="bigint">
          <constraints nullable="false" />
      </column>
      <column name="pozice" type="int">
        <constraints nullable="false" />
      </column>
      <column name="metadata" type="mediumtext" />
    </createTable>

    <createTable tableName="notifikace">
      <column name="notifikace_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="typ" type="varchar(64)">
        <constraints nullable="false" />
      </column>
      <column name="prijemce" type="varchar(64)">
        <constraints nullable="false" />
      </column>
      <column name="predmet" type="text">
        <constraints nullable="false" />
      </column>
      <column name="mime" type="varchar(255)">
        <constraints nullable="false" />
      </column>
      <column name="obsah" type="text" >
        <constraints nullable="false" />
      </column>
    </createTable>

    <createTable tableName="event">
      <column name="event_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="queue_name" type="varchar(32)">
        <constraints nullable="false" />
      </column>
      <column name="category_name" type="varchar(255)">
        <constraints nullable="false" />
      </column>
      <column name="operation" type="varchar(32)" />
      <column name="state" type="nvarchar(16)">
        <constraints nullable="false" />
      </column>
      <column name="inserted" type="datetime">
        <constraints nullable="false" />
      </column>
      <column name="last_update" type="datetime" />
      <column name="next_run" type="datetime" />
      <column name="dependent_event_id" type="bigint" />
      <column name="error_desc" type="text" />
      <column name="context" type="varchar(1024)" />
      <column name="rizeni_id" type="bigint" />
      <column name="informacni_balicek_id" type="bigint" />
      <column name="auditni_log_id" type="bigint" />
      <column name="notifikace_id" type="bigint" />
    </createTable>

    <createTable tableName="auditni_log">
      <column name="auditni_log_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="uzivatel_id" type="varchar(32)" />
      <column name="typ" type="varchar(32)">
        <constraints nullable="false" />
      </column>
      <column name="cas_vytvoreni" type="datetime">
        <constraints nullable="false" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" />
      </column>
    </createTable>

    <createTable tableName="transakce">
      <column name="transakce_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="stav" type="varchar(32)">
        <constraints nullable="false" />
      </column>
      <column name="typ" type="varchar(64)">
        <constraints nullable="false" />
      </column>
      <column name="start" type="datetime">
        <constraints nullable="false" />
      </column>
      <column name="stop" type="datetime" />
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" references="rizeni(rizeni_id)" foreignKeyName="fk_transakce_rizeni"/>
      </column>
      <column name="chyba" type="text" />
    </createTable>

    <createTable tableName="stazitelny_soubor">
      <column name="stazitelny_soubor_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" references="rizeni(rizeni_id)" foreignKeyName="fk_stazitelny_soubor_rizeni"/>
      </column>
      <column name="typ_souboru" type="varchar(32)">
        <constraints nullable="false" /> 
      </column>
      <column name="format" type="varchar(128)">
        <constraints nullable="false" />
      </column>
      <column name="cesta" type="varchar(64)">
        <constraints nullable="false" />
      </column>
      <column name="vytvoren" type="datetime">
        <constraints nullable="false" />
      </column>
      <column name="popis" type="varchar(255)" />
      <column name="uzivatel_id" type="varchar(32)" />
      <column name="smazan" type="boolean" defaultValueBoolean="false" />
    </createTable>

	<createTable tableName="historie">
      <column name="historie_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" foreignKeyName="fk_historie_rizeni"
        	references="rizeni(rizeni_id)" />
      </column>
      <column name="cas_udalosti" type="datetime">
        <constraints nullable="false"/>
      </column>
      <column name="typ_udalosti" type="varchar(32)">
        <constraints nullable="false"/>
      </column>
      <column name="popis_udalosti" type="text" />
      <column name="uzivatel_id" type="varchar(32)"/>      
	</createTable>
  
    <createTable tableName="atribut_urovne">
      <column name="atribut_urovne_id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" />
      </column>
      <column name="zobrazeni_urovne_id" type="bigint">
        <constraints nullable="false" foreignKeyName="fk_atribut_urovne_zobrazeni_urovne"
          references="zobrazeni_urovne(zobrazeni_urovne_id)" />
      </column>
      <column name="rizeni_id" type="bigint">
        <constraints nullable="false" foreignKeyName="fk_atribut_urovne_rizeni"
          references="rizeni(rizeni_id)" />
      </column>
      <column name="nazev" type="varchar(64)">
        <constraints nullable="false"/>
      </column>
      <column name="hodnota" type="varchar(512)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    
    <createIndex indexName="idx_atribut_urovne_rizeni" tableName="atribut_urovne" unique="false">
      <column name="rizeni_id" />
      <column name="hodnota" />
    </createIndex>    

    <addForeignKeyConstraint constraintName="event_dependent_event_id"
		baseTableName="event" baseColumnNames="dependent_event_id"
		referencedTableName="event" referencedColumnNames="event_id" />

    <addForeignKeyConstraint constraintName="event_rizeni_id"
		baseTableName="event" baseColumnNames="rizeni_id"
        referencedTableName="rizeni" referencedColumnNames="rizeni_id" />

    <addForeignKeyConstraint constraintName="event_informacni_balicek_id"
		baseTableName="event" baseColumnNames="informacni_balicek_id"
        referencedTableName="informacni_balicek" referencedColumnNames="informacni_balicek_id" />

    <addForeignKeyConstraint constraintName="event_auditni_log_id"
		baseTableName="event" baseColumnNames="auditni_log_id"
		referencedTableName="auditni_log" referencedColumnNames="auditni_log_id" />

    <addForeignKeyConstraint constraintName="event_notifikace_id"
        baseTableName="event" baseColumnNames="notifikace_id"
        referencedTableName="notifikace" referencedColumnNames="notifikace_id" />

  </changeSet>

</databaseChangeLog>